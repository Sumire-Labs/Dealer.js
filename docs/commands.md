# Dealer.js コマンド・仕様リファレンス

## 目次

- [カジノゲーム](#カジノゲーム)
  - [/slots — スロットマシン](#slots--スロットマシン)
  - [/coinflip — コインフリップ](#coinflip--コインフリップ)
  - [/blackjack — ブラックジャック](#blackjack--ブラックジャック)
  - [/race — 競馬](#race--競馬)
  - [/poker — テキサスホールデム](#poker--テキサスホールデム)
- [経済システム](#経済システム)
  - [/daily — デイリーボーナス](#daily--デイリーボーナス)
  - [/balance — 残高・統計](#balance--残高統計)
  - [/leaderboard — リーダーボード](#leaderboard--リーダーボード)
  - [/bank — 銀行](#bank--銀行)
- [管理者コマンド](#管理者コマンド)
  - [/give — チップ付与](#give--チップ付与)
  - [/reset — ユーザーリセット](#reset--ユーザーリセット)
  - [/setting — Bot 設定](#setting--bot-設定)
- [共通仕様](#共通仕様)

---

## カジノゲーム

### /slots — スロットマシン

3 リールのスロットマシン。シンボルの組み合わせで配当が決まる。

| 項目 | 値 |
|---|---|
| 最小ベット | $100 |
| 最大ベット | $50,000 |
| デフォルトベット | $100 |

#### シンボル一覧

| シンボル | ランク |
|---|---|
| 💎 ダイヤモンド | スペシャル |
| 7️⃣ セブン | 高 |
| 👑 クラウン | 高 |
| 🔔 ベル | 中 |
| ⭐ スター | 中 |
| 🍒 チェリー | 低 |
| 🍋 レモン | 低 |
| 🍇 グレープ | 低 |

#### 配当テーブル

| 条件 | 倍率 |
|---|---|
| 💎💎💎 ジャックポット | 500x |
| 💎💎 + 任意 | 5x |
| 💎 + 任意 2 つ | 2x |
| 高ランク 3 つ揃い | 40x |
| 中ランク 3 つ揃い | 20x |
| 低ランク 3 つ揃い | 10x |
| 同シンボル 2 つ | 2x |
| ハズレ | 0x |

#### 操作

- **BET -** / **BET +** — ベット額調整
- **MAX BET** — 最大ベットに設定
- **SPIN** — リール回転

---

### /coinflip — コインフリップ

表か裏を選んで賭ける、シンプルな 50/50 ゲーム。

| 項目 | 値 |
|---|---|
| 最小ベット | $100 |
| 最大ベット | $500,000 |
| 勝利倍率 | 2x (賭け金 + 同額の利益) |
| 勝率 | 50% |

#### 操作

- **表 (Heads)** / **裏 (Tails)** — コイン選択で即時判定
- **BET -** / **BET +** — 次回ベット額調整
- **リプレイ** — 同じ面で再プレイ

---

### /blackjack — ブラックジャック

ディーラーと 1 対 1 の対戦。標準的なブラックジャックルール。

| 項目 | 値 |
|---|---|
| 最小ベット | $100 |
| 最大ベット | $100,000 |
| デッキ数 | 4 |
| ディーラースタンド | 17 以上 |

#### 配当

| 結果 | 倍率 |
|---|---|
| ブラックジャック (A + 10/J/Q/K) | 2.5x (3:2) |
| 通常勝利 | 2x (1:1) |
| プッシュ (引き分け) | 1x (返金) |
| インシュランス的中 | インシュランス額の 3x (2:1) |

#### プレイヤーアクション

| アクション | 条件 | 説明 |
|---|---|---|
| ヒット | いつでも | カードを 1 枚引く |
| スタンド | いつでも | ターン終了 |
| ダブルダウン | 最初の 2 枚のみ | ベットを倍額にして 1 枚だけ引く |
| スプリット | 同じ値のペアのみ | 手札を 2 つに分けてそれぞれプレイ |
| インシュランス | ディーラーの表が A | ベットの半額を追加で賭ける |

#### ゲームフロー

1. プレイヤーとディーラーに 2 枚ずつ配布 (ディーラーの 2 枚目は裏向き)
2. ナチュラルブラックジャックの判定
3. プレイヤーがアクション選択 (ヒット / スタンド / ダブル / スプリット)
4. プレイヤー終了後、ディーラーがホールカードを公開
5. ディーラーは 17 未満で必ずヒット、17 以上でスタンド
6. 結果判定・配当

---

### /race — 競馬

チャンネル内のプレイヤーが馬に賭けるマルチプレイヤーゲーム。

| 項目 | 値 |
|---|---|
| 最小ベット | $100 |
| 最大ベット | $100,000 |
| ベッティング時間 | 60 秒 |
| 最小参加者 | 2 人 |
| 馬の数 | 5 頭 |

#### 馬のオッズと勝率

| 馬 | レーティング | 勝率 | オッズ |
|---|---|---|---|
| 1 番馬 | ★★★★★ | 40% | 1.5x |
| 2 番馬 | ★★★★ | 25% | 2.5x |
| 3 番馬 | ★★★ | 17% | 4.0x |
| 4 番馬 | ★★ | 12% | 7.0x |
| 5 番馬 | ★ | 6% | 15.0x |

- 馬の名前は `/setting` コマンドまたは `config.yaml` でカスタマイズ可能
- レースはアニメーション付きで実行 (8 フレーム、1.2 秒間隔)
- 1 セッションにつき 1 人 1 回のみ賭け可能
- 10 分間操作なしのセッションは自動クリーンアップ

---

### /poker — テキサスホールデム

最大 6 人参加のテキサスホールデムポーカー。

| 項目 | 値 |
|---|---|
| 最小バイイン | $2,000 |
| 最大バイイン | $100,000 |
| 最小プレイヤー | 2 人 |
| 最大プレイヤー | 6 人 |
| スモールブラインド | $100 |
| ビッグブラインド | $200 |
| ロビー待機時間 | 60 秒 |
| アクションタイムアウト | 45 秒 |

#### ゲームフロー

1. **ロビー** — プレイヤー参加受付 (60 秒またはオーナーが開始)
2. **プリフロップ** — 各プレイヤーに 2 枚のホールカード配布、ベッティング
3. **フロップ** — コミュニティカード 3 枚公開、ベッティング
4. **ターン** — コミュニティカード 1 枚追加、ベッティング
5. **リバー** — コミュニティカード 1 枚追加、最終ベッティング
6. **ショーダウン** — 残存プレイヤーのハンド比較、配当

#### アクション

| アクション | 説明 |
|---|---|
| フォールド | 手札を捨てて降りる |
| チェック | ベットせずパス (ベットが 0 の場合のみ) |
| コール | 現在のベット額に合わせる |
| レイズ | ベット額を引き上げる (モーダルで金額入力) |
| オールイン | 全チップを賭ける |

- 全員フォールドで即座に勝者確定
- オールイン時はサイドポットが自動計算
- 45 秒以内にアクションしない場合は自動フォールド
- ホールカードは **パネル** ボタンで ephemeral メッセージとして確認

#### ハンドランキング (強い順)

1. ロイヤルフラッシュ
2. ストレートフラッシュ
3. フォーカード
4. フルハウス
5. フラッシュ
6. ストレート
7. スリーカード
8. ツーペア
9. ワンペア
10. ハイカード

---

## 経済システム

### /daily — デイリーボーナス

24 時間ごとにボーナスチップを受け取れる。

| 項目 | 値 |
|---|---|
| 通常ボーナス | $2,500 |
| 救済ボーナス (残高 0 以下) | $5,000 |
| クールダウン | 24 時間 |
| 連続ログインストリーク | 48 時間以内に再取得で継続、超過でリセット |

---

### /balance — 残高・統計

自分や他のプレイヤーの残高と統計を確認。表示は ephemeral (本人のみ閲覧可能)。

#### 残高タブ

- 💰 チップ (ウォレット残高)
- 🏦 口座 (銀行残高)
- 🏆 ランク (リーダーボード順位)

#### 統計タブ

- プレイ回数
- 総獲得額 / 総損失額
- 収支
- 勝率

**オプション**: `/balance user:@someone` で他プレイヤーの情報を閲覧可能。

---

### /leaderboard — リーダーボード

チップ残高でのプレイヤーランキング。

- 1 ページあたり 10 人表示
- ページネーションボタンで前後移動
- 自分の順位をハイライト表示
- 表示項目: 順位、プレイヤー名、チップ、プレイ回数

---

### /bank — 銀行

口座管理とローンの 2 タブ構成。

#### 口座タブ

ウォレットとは別の銀行口座でチップを管理。

| 機能 | 説明 |
|---|---|
| 入金 | ウォレット → 口座 にチップを移動 |
| 出金 | 口座 → ウォレット にチップを移動 |
| 送金 | 自分の口座 → 相手の口座 に直接送金 |
| 利息 | 口座残高に対して日利 1% が自動付与 |

**利息の条件**:
- 口座残高が $100 以上であること
- 24 時間ごとに付与 (1 時間間隔でチェック)
- 見込み利息額が UI に表示される

**送金**: 相手の Discord ユーザー ID を指定。メンション形式 (`<@123>`) にも対応。

#### ローンタブ

| 項目 | 値 |
|---|---|
| 最小借入額 | $1,000 |
| 最大借入額 | $50,000 (1 回あたり) |
| 借入上限 (合計元金) | $100,000 |
| 金利 | 10 時間あたり 10% |
| 利息計算 | 経過時間に比例して連続的に増加 |

| 機能 | 説明 |
|---|---|
| 借入 | チップをローンとして借りる (ウォレットに加算) |
| 返済 | ウォレットのチップでローンを返済 (古いローンから順に消化) |
| 破産 | 全ローンを帳消しにする (ペナルティあり) |

**自己破産のペナルティ**:
- 全ローンが帳消し
- ウォレットの全チップを没収
- 銀行口座の全残高を没収
- $2,500 を支給
- **1 時間のギャンブル報酬 -10% ペナルティ** (勝利時の配当が 10% 減少)

---

## 管理者コマンド

### /give — チップ付与

サーバー管理者が指定ユーザーにチップを付与する。

| 項目 | 値 |
|---|---|
| 必要権限 | Administrator |
| パラメータ | `user` (対象ユーザー)、`amount` (付与額) |

トランザクションログに `ADMIN_GIVE` として記録される。

### /reset — ユーザーリセット

指定ユーザーのデータを初期状態に戻す。

| 項目 | 値 |
|---|---|
| 必要権限 | Administrator |
| リセット内容 | チップ → $10,000、口座残高 → $0、統計 → 全てゼロ、デイリー → リセット |

トランザクションログに `ADMIN_RESET` として記録される。

### /setting — Bot 設定

Bot のカスタム設定を管理する。

| 項目 | 値 |
|---|---|
| 必要権限 | Manage Guild |
| 設定可能項目 | 競馬の馬の名前 |

モーダル形式で名前を入力し、データベースに保存。`config.yaml` のデフォルト値より優先される。

---

## 共通仕様

### コマンドクールダウン

全コマンド共通で **3 秒** のクールダウン。連打防止。

### 破産ペナルティ

破産宣告後 1 時間は、全てのカジノゲームの **勝利配当が 10% 減少** する。ベットやローンには影響しない。

### トランザクション記録

全てのチップ移動はデータベースに記録される。

| タイプ | 説明 |
|---|---|
| `WIN` | ゲーム勝利 |
| `LOSS` | ゲーム敗北 |
| `DAILY` | デイリーボーナス |
| `ADMIN_GIVE` | 管理者チップ付与 |
| `ADMIN_RESET` | 管理者リセット |
| `LOAN_BORROW` | ローン借入 |
| `LOAN_REPAY` | ローン返済 |
| `BANKRUPTCY` | 自己破産 |
| `BANK_DEPOSIT` | 口座入金 |
| `BANK_WITHDRAW` | 口座出金 |
| `BANK_TRANSFER_SEND` | 送金 (送信側) |
| `BANK_TRANSFER_RECV` | 送金 (受信側) |
| `BANK_INTEREST` | 利息付与 |

### 初期状態

新規ユーザーが初めてコマンドを使用すると自動的にアカウントが作成される。

| 項目 | 初期値 |
|---|---|
| チップ | $10,000 |
| 口座残高 | $0 |
| ゲーム数 | 0 |
| ランク | 最下位 |

### 定期タスク (スケジューラー)

| タスク | 間隔 | 説明 |
|---|---|---|
| レースセッション cleanup | 10 分 | 放置されたレースセッションの削除 |
| 利息配布 | 1 時間 | 口座残高 $100 以上のユーザーに日利 1% 付与 |

### テーマカラー

| 用途 | カラー |
|---|---|
| 標準 (スロット、残高、リーダーボード) | ゴールド (#FFD700) |
| カードゲーム (ブラックジャック、ポーカー) | ダークグリーン (#1B5E20) |
| 競馬 | パープル (#7B1FA2) |
| 敗北・エラー・破産 | レッド (#D32F2F) |
| コインフリップ | シルバー (#C0C0C0) |
| 管理者コマンド | ダイヤモンドブルー (#00BCD4) |
