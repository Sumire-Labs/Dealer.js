# Changelog

## v1.11.4
- **複数クラフト/開封**: 複数合成・複数開封モーダルでComponents V2のエラーが発生する問題を修正

## v1.11.3

### Bug Fixes
- **チンチロ**: ソロモードで勝利時にチップが正しく支払われないバグを修正。利益倍率と総ペイアウト倍率の不整合が原因で、ポイント勝ちの純利益が0になっていた

### New Features
- **SI接頭語対応**: チップ額の入力で `2k` (2,000)、`1.5m` (1,500,000)、`1b` (1,000,000,000) などの省略記法が使用可能に。銀行（入出金/送金/借入/返済/定期預金）、ベット、ポーカー、ギフトの全モーダルに対応
- **複数クラフト**: クラフト確認画面から「📦 複数合成」ボタンで1〜10回の一括合成が可能に
- **複数開封**: インベントリでミステリーボックスを2個以上所持時に「📦 複数開封」ボタンが表示され、1〜10個の一括開封が可能に
- **クラフトタブ矢印選択**: クラフトタブのレシピ選択が▲▼カーソル方式に統一
- **日替わりタブ矢印選択**: 日替わりショップのアイテム選択が▲▼カーソル方式に統一

## v1.11.2

### New Features
- **ショップ**: 永続パーセンテージ系アイテムの効果スタッキングに対応
- **ショップ**: アイテム個別の購入ボタンを▲▼カーソル選択UIに置き換え
- **インベントリ**: ゴールデンボックスをミステリーフィルターに表示するよう変更

## v1.11.1

### Bug Fixes
- **管理**: デバッグモーダルのレスポンスでComponents V2エラーが発生する問題を修正

## v1.11.0

### New Features
- **チンチロ**: ソロモード・マルチプレイヤーモード対応のチンチロ（丁半サイコロ）ゲームを追加

## v1.10.8

### Improvements
- **リファクタ**: インポートの最適化、コード全体の整理

## v1.10.7

### New Features
- **ブラックジャック**: マルチプレイヤーテーブルモードを追加

## v1.10.6

### Improvements
- **パフォーマンス**: セッションリーク修正、Discord API呼び出しの最適化
- **パフォーマンス**: インベントリチェック・ペナルティ検索のDBクエリバッチ化
- **パフォーマンス**: 実績・ミッション・コレクション・統計クエリの最適化
- **パフォーマンス**: クールダウン・期限切れバフの定期クリーンアップ追加

## v1.10.5

### Improvements
- **依存関係**: npmパッケージの更新

## v1.10.4

### Bug Fixes
- **銀行**: 定期預金の枠数上限チェックにおけるレースコンディションを修正

## v1.10.3

### Bug Fixes
- **ローン**: 利子未満の一部返済でチップが消失するバグを修正

### Improvements
- **ベット**: ルーレットのスピン経路にmax-betガードを追加、モーダル入力制限の緩和

## v1.10.2

### Bug Fixes
- **ベット**: BJ/コインフリップ/ルーレットコマンド及びポーカーモーダルでmax-betバリデーションが欠落していた問題を修正

## v1.10.1

### New Features
- **ワーク**: 緊急・トレーニングの特殊シフトに独立クールダウンを付与

### Improvements
- **ベット**: configで0を設定した場合に無制限ベットを許可するよう変更

## v1.10.0

### New Features
- **ヘルプ**: `/help` にアイテムWikiを追加 — 全52アイテムのカテゴリ/詳細閲覧
- **管理**: `/give` と `/reset` を統合 `/debug` パネルに置き換え
- **インベントリ**: ▲▼カーソル選択UI追加 — 選択中アイテムのアクションのみ表示
- **ビジネス**: ビジネス売却機能を追加（30%返金で物件変更可能）

### Bug Fixes
- **ワーク**: シフトクールダウン表示が小数時間で表示される問題を修正
- **インベントリ**: ミステリーボックスの結果画面がインベントリではなくショップに遷移する問題を修正
- **ショップ**: ユニバーサルツールキットのmaxStackが厳しすぎた問題を修正（3個まで購入可能に）
- **インベントリ**: ページ2でインデックスが範囲外になりクラッシュする問題を修正
- **ショップ**: 購入確認画面でランク割引価格が表示されない問題を修正

### Improvements
- **リファクタ**: 11個の大型ファイルをドメイン別サブモジュールに分割
- **ショップ**: 購入後の全ショップ再構築を軽量な結果ビューに置き換え
- **ワーク**: 昇進ジョブのマスタリーゲートを撤廃 — ワークLv.5のみで解放

## v1.9.2

### Bug Fixes
- **全般**: カジノゲーム、ギフト、UIインタラクションにおける重大バグを修正

## v1.9.1

### Bug Fixes
- **全般**: セッションリーク、エラーハンドリング、BigInt精度、メモリ増大の6件のバグを修正

## v1.9.0

### New Features
- **ギフト**: ギフトUIをContainerBuilder + TextDisplayBuilderに移行

### Bug Fixes
- **ハイスト**: ソロハイストのアニメーションが表示されない・マルチプレイヤー実績の誤りを修正

### Improvements
- **UI**: Phase 2 — 銀行バグ修正 + 3コマンドのSelectMenu化 + 5つのUI改善

## v1.8.0

### New Features
- **銀行**: `/bank` コマンドの大幅強化 — 5つの新機能追加

### Improvements
- **UI**: 大規模リファクタ — 5コマンドのボタンをStringSelectMenuに置き換え、BJ/ポーカー表示の改善

## v1.7.0

### Bug Fixes
- **全般**: 軽微なバグ修正

## v1.6.0

### New Features
- **ショップ**: 大幅強化 — 6つの新機能、約20の新アイテム、8つの新実績
- **設定**: 全53の定数を動的に設定可能なジェネリック設定レジストリを追加

### Bug Fixes
- **全般**: Discord.js v2コンポーネント互換性の修正と複数のバグ修正

### Improvements
- **設定**: 銀行利率・初期チップを動的設定可能に

## v1.0.0 ~ v1.5.x (初期開発)

### コアシステム
- **カジノ**: スロット、ブラックジャック、コインフリップの基盤実装
- **経済**: チップシステム、残高管理、リーダーボード
- **競馬**: レース・ベットシステム（オーナーアクセス制御付き）
- **ポーカー**: テキサスホールデム（フルゲームエンジン）
- **ルーレット**: ルーレットゲーム実装

### 金融システム
- **銀行口座**: 入金・出金・送金・デイリー利息
- **ローン**: 借入・返済・破産システム
- **宝くじ**: 宝くじシステム

### アクティビティ
- **ワーク**: カジノ従業員シフト（ジョブ・レベリング・ストリーク）
- **ワーク拡張**: マスタリー、マルチステップイベント、特殊シフト、昇進、週次チャレンジ、ツール
- **ワーク拡張2**: 残業システム（1.5x/2.0x/3.0x）、チームシフト（2〜4人）、ビジネス経営（5段階）
- **ハイスト**: ハイストシステム（ターゲット・リスク・アプローチ選択）
- **プリズン**: 刑務所・脱獄システム

### ショップ・コレクション
- **ショップ**: アイテム、バフ、ミステリーボックス、コスメティック、日替わりローテーション
- **実績**: 実績システム
- **デイリーミッション**: 日次ミッション（JST 05:00リセット）

### インフラ
- **設定**: `config.yaml` ベースの設定システム、`/setting` コマンド
- **デプロイ**: Discordコマンド登録、Docker対応
- **スケジューラ**: デイリーリセットスケジューラ
- **ヘルプ**: ゲーム内ヘルプコマンド
- **UI**: Components V2対応、エフェメラルレスポンス
- **リファクタ**: 大型ファイルの分割、オーナーチェック統合
